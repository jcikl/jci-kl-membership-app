# Firebase è§„åˆ™åˆå¹¶å’Œéƒ¨ç½²æŒ‡å—

## ğŸ“‹ è§„åˆ™åˆå¹¶å®Œæˆ

æˆ‘å·²ç»æˆåŠŸå°†ä½ æä¾›çš„ç®€å•Firestoreè§„åˆ™ä¸ç°æœ‰çš„è¯¦ç»†è§„åˆ™åˆå¹¶ï¼ŒåŒæ—¶åŒ…å«äº†Storageè§„åˆ™ã€‚

### ğŸ”„ åˆå¹¶å†…å®¹

#### 1. **Firestore è§„åˆ™**
- âœ… ä½¿ç”¨æ—¶é—´é™åˆ¶è§„åˆ™ï¼š`allow read, write: if request.time < timestamp.date(2025, 10, 10);`
- âœ… ä¿ç•™åŸæœ‰çš„è¯¦ç»†ç”Ÿäº§ç¯å¢ƒè§„åˆ™ï¼ˆæ³¨é‡ŠçŠ¶æ€ï¼‰
- âœ… æ·»åŠ äº†ä¸­æ–‡æ³¨é‡Šè¯´æ˜

#### 2. **Storage è§„åˆ™**
- âœ… åˆå¹¶åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­
- âœ… ä½¿ç”¨ç›¸åŒçš„æ—¶é—´é™åˆ¶è§„åˆ™ï¼š`allow read, write: if request.time < timestamp.date(2025, 10, 10);`
- âœ… ç”Ÿäº§ç¯å¢ƒè§„åˆ™ï¼ˆæ³¨é‡ŠçŠ¶æ€ï¼‰

### ğŸ“ æ–‡ä»¶ç»“æ„

```
â”œâ”€â”€ firestore.rules          # åˆå¹¶åçš„è§„åˆ™æ–‡ä»¶ï¼ˆåŒ…å«Firestoreå’ŒStorageï¼‰
â”œâ”€â”€ firebase.json            # Firebaseé…ç½®æ–‡ä»¶
â””â”€â”€ DEPLOY_MERGED_RULES_GUIDE.md  # æœ¬æŒ‡å—
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ–¹æ³•1: é€šè¿‡Firebase Consoleï¼ˆæ¨èï¼‰

1. **è®¿é—®Firebase Console**
   - æ‰“å¼€ [Firebase Console](https://console.firebase.google.com/)
   - é€‰æ‹©é¡¹ç›® `jci-kl-membership-app`

2. **éƒ¨ç½²Firestoreè§„åˆ™**
   - è¿›å…¥ **Firestore Database** > **Rules**
   - å¤åˆ¶ `firestore.rules` æ–‡ä»¶ä¸­çš„ `service cloud.firestore` éƒ¨åˆ†
   - ç²˜è´´åˆ°è§„åˆ™ç¼–è¾‘å™¨ä¸­
   - ç‚¹å‡» **å‘å¸ƒ**

3. **éƒ¨ç½²Storageè§„åˆ™**
   - è¿›å…¥ **Storage** > **Rules**
   - å¤åˆ¶ `firestore.rules` æ–‡ä»¶ä¸­çš„ `service firebase.storage` éƒ¨åˆ†
   - ç²˜è´´åˆ°è§„åˆ™ç¼–è¾‘å™¨ä¸­
   - ç‚¹å‡» **å‘å¸ƒ**

### æ–¹æ³•2: é€šè¿‡Firebase CLI

```bash
# 1. ç™»å½•Firebase
firebase login

# 2. è®¾ç½®é¡¹ç›®
firebase use jci-kl-membership-app

# 3. éƒ¨ç½²æ‰€æœ‰è§„åˆ™
firebase deploy --only firestore:rules,storage

# æˆ–è€…åˆ†åˆ«éƒ¨ç½²
firebase deploy --only firestore:rules
firebase deploy --only storage
```

## ğŸ“ åˆå¹¶åçš„è§„åˆ™è¯´æ˜

### Firestore è§„åˆ™ç‰¹ç‚¹

```javascript
// ä¸´æ—¶å¼€å‘è§„åˆ™ï¼ˆå½“å‰ç”Ÿæ•ˆï¼‰
match /{document=**} {
  allow read, write: if request.time < timestamp.date(2025, 10, 10);
}

// è¯¦ç»†ç”Ÿäº§è§„åˆ™ï¼ˆæ³¨é‡ŠçŠ¶æ€ï¼Œå°†æ¥å¯ç”¨ï¼‰
// åŒ…å«ä¼šå‘˜ã€æ´»åŠ¨ã€è´¢åŠ¡ã€äº¤æ˜“ç­‰é›†åˆçš„è¯¦ç»†æƒé™æ§åˆ¶
```

### Storage è§„åˆ™ç‰¹ç‚¹

```javascript
// å¼€å‘ç¯å¢ƒè§„åˆ™ï¼ˆå½“å‰ç”Ÿæ•ˆï¼‰
match /{allPaths=**} {
  allow read, write: if true;
}

// ç”Ÿäº§ç¯å¢ƒè§„åˆ™ï¼ˆæ³¨é‡ŠçŠ¶æ€ï¼Œå°†æ¥å¯ç”¨ï¼‰
// åŒ…å«event-coversã€chapter-logosã€member-avatarsç­‰è·¯å¾„çš„æƒé™æ§åˆ¶
```

## âš ï¸ é‡è¦æé†’

### 1. **ä¸´æ—¶è§„åˆ™åˆ°æœŸ**
- å½“å‰è§„åˆ™åœ¨ **2025å¹´10æœˆ10æ—¥** åˆ°æœŸ
- åˆ°æœŸåæ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚å°†è¢«æ‹’ç»
- éœ€è¦åœ¨åˆ°æœŸå‰å¯ç”¨ç”Ÿäº§ç¯å¢ƒè§„åˆ™

### 2. **ç”Ÿäº§ç¯å¢ƒå‡†å¤‡**
- è¯¦ç»†çš„ç”Ÿäº§ç¯å¢ƒè§„åˆ™å·²å‡†å¤‡å¥½ï¼ˆæ³¨é‡ŠçŠ¶æ€ï¼‰
- éœ€è¦æ—¶åªéœ€å–æ¶ˆæ³¨é‡Šå¹¶åˆ é™¤ä¸´æ—¶è§„åˆ™
- å»ºè®®åœ¨æ­£å¼å‘å¸ƒå‰å¯ç”¨ç”Ÿäº§ç¯å¢ƒè§„åˆ™

### 3. **å®‰å…¨è€ƒè™‘**
- å½“å‰è§„åˆ™å…è®¸æ‰€æœ‰è®¿é—®ï¼Œé€‚åˆå¼€å‘ç¯å¢ƒ
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨æ›´ä¸¥æ ¼çš„è§„åˆ™
- å»ºè®®åœ¨æµ‹è¯•å®Œæˆåç«‹å³åˆ‡æ¢åˆ°ç”Ÿäº§è§„åˆ™

## ğŸ”§ åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒè§„åˆ™

å½“å‡†å¤‡å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ï¼š

1. **ç¼–è¾‘ `firestore.rules`**
2. **åˆ é™¤ä¸´æ—¶è§„åˆ™**ï¼š
   ```javascript
   // åˆ é™¤è¿™éƒ¨åˆ†
   match /{document=**} {
     allow read, write: if request.time < timestamp.date(2025, 10, 10);
   }
   ```

3. **å¯ç”¨ç”Ÿäº§è§„åˆ™**ï¼š
   ```javascript
   // å–æ¶ˆæ³¨é‡Šæ‰€æœ‰ç”Ÿäº§ç¯å¢ƒè§„åˆ™
   // åˆ é™¤ /* å’Œ */ æ ‡è®°
   ```

4. **é‡æ–°éƒ¨ç½²è§„åˆ™**

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. **Firestore æµ‹è¯•**
- å°è¯•è¯»å–/å†™å…¥å„ç§é›†åˆ
- éªŒè¯æƒé™æ˜¯å¦æ­£ç¡®

### 2. **Storage æµ‹è¯•**
- ä½¿ç”¨ `test-image-upload.html` æµ‹è¯•å›¾ç‰‡ä¸Šä¼ 
- éªŒè¯CORSé”™è¯¯æ˜¯å¦è§£å†³

### 3. **åº”ç”¨æµ‹è¯•**
- åœ¨EventFormä¸­æµ‹è¯•å›¾ç‰‡ä¸Šä¼ 
- éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

## ğŸ“ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è§„åˆ™éƒ¨ç½²å¤±è´¥**
   - æ£€æŸ¥è¯­æ³•é”™è¯¯
   - ç¡®è®¤Firebase CLIç‰ˆæœ¬
   - é‡æ–°ç™»å½•Firebase

2. **æƒé™é”™è¯¯**
   - æ£€æŸ¥è§„åˆ™æ˜¯å¦æ­£ç¡®éƒ¨ç½²
   - éªŒè¯ç”¨æˆ·è®¤è¯çŠ¶æ€
   - æŸ¥çœ‹Firebase Consoleæ—¥å¿—

3. **CORSé”™è¯¯**
   - ç¡®è®¤Storageè§„åˆ™å·²éƒ¨ç½²
   - æ£€æŸ¥StorageæœåŠ¡çŠ¶æ€
   - éªŒè¯æ–‡ä»¶è·¯å¾„æ­£ç¡®

## ğŸ¯ é¢„æœŸç»“æœ

éƒ¨ç½²æˆåŠŸååº”è¯¥èƒ½å¤Ÿï¼š

- âœ… **Firestoreè®¿é—®**ï¼šæ‰€æœ‰æ•°æ®åº“æ“ä½œæ­£å¸¸å·¥ä½œ
- âœ… **Storageä¸Šä¼ **ï¼šå›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- âœ… **CORSè§£å†³**ï¼šä¸å†å‡ºç°è·¨åŸŸé”™è¯¯
- âœ… **æƒé™æ§åˆ¶**ï¼šå¼€å‘ç¯å¢ƒå®Œå…¨å¼€æ”¾ï¼Œç”Ÿäº§ç¯å¢ƒå—æ§

## ğŸ“… æ—¶é—´çº¿

- **ç°åœ¨**ï¼šä½¿ç”¨ä¸´æ—¶å¼€å‘è§„åˆ™
- **å¼€å‘æœŸé—´**ï¼šæ‰€æœ‰åŠŸèƒ½å®Œå…¨å¼€æ”¾
- **2025å¹´10æœˆ10æ—¥å‰**ï¼šåˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒè§„åˆ™
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šä¸¥æ ¼çš„æƒé™æ§åˆ¶

è¿™ä¸ªåˆå¹¶æ–¹æ¡ˆæ—¢æ»¡è¶³äº†ä½ å½“å‰çš„å¼€å‘éœ€æ±‚ï¼Œåˆä¸ºå°†æ¥çš„ç”Ÿäº§ç¯å¢ƒåšå¥½äº†å‡†å¤‡ï¼
