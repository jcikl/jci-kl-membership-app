# 分会Logo上传功能使用指南

## 功能概述

分会Logo上传功能允许管理员上传、预览、管理和删除分会的Logo图片。支持完整的CRUD操作，包括图片压缩、格式验证和云端存储。

## 功能特性

### 🖼️ 图片上传
- **支持格式**：JPG、PNG、GIF
- **文件大小**：最大5MB
- **图片尺寸**：建议200x200像素，最大2000x2000像素
- **自动压缩**：大于500KB的图片会自动压缩
- **云端存储**：使用Firebase Storage存储图片

### 👁️ 图片预览
- **实时预览**：上传后立即显示缩略图
- **全屏预览**：点击预览按钮查看大图
- **响应式显示**：适配不同屏幕尺寸

### 🗑️ 图片管理
- **删除功能**：支持删除已上传的图片
- **云端同步**：删除时同时从云端存储中移除
- **错误处理**：删除失败时提供友好提示

## 使用方法

### 上传Logo
1. 进入系统设置 → 分会设置
2. 在"分会标识"部分找到"分会Logo"字段
3. 点击"点击上传分会Logo"按钮
4. 选择图片文件（支持拖拽上传）
5. 等待上传完成，查看预览图

### 预览Logo
1. 在Logo预览区域点击眼睛图标
2. 在弹出的模态框中查看大图
3. 点击空白区域或关闭按钮退出预览

### 删除Logo
1. 在Logo预览区域点击删除图标
2. 确认删除操作
3. 图片将从表单和云端存储中移除

### 查看Logo
- **仪表板**：在仪表板顶部的分会信息卡片中查看Logo
- **系统设置**：在分会设置页面查看当前Logo

## 技术实现

### 存储架构
- **本地存储**：使用Ant Design的Upload组件处理文件选择
- **云端存储**：使用Firebase Storage存储图片文件
- **URL管理**：将云端URL保存到Firestore数据库

### 图片处理
- **格式验证**：检查文件类型和大小
- **尺寸检查**：验证图片尺寸是否合理
- **自动压缩**：大文件自动压缩以节省存储空间
- **预览生成**：生成缩略图用于界面显示

### 错误处理
- **上传失败**：显示具体错误信息
- **删除失败**：提供降级处理方案
- **网络错误**：自动重试机制

## 配置选项

### ImageUpload组件参数
```typescript
interface ImageUploadProps {
  value?: string;                    // 当前图片URL
  onChange?: (url: string | null) => void;  // 变化回调
  maxSize?: number;                  // 最大文件大小(MB)
  accept?: string;                   // 接受的文件类型
  disabled?: boolean;                // 是否禁用
  placeholder?: string;              // 占位符文本
  storagePath?: string;              // 存储路径
  enableCompression?: boolean;       // 是否启用压缩
}
```

### 默认配置
- **最大文件大小**：5MB
- **支持格式**：image/*
- **存储路径**：chapter-logos/
- **压缩启用**：是
- **压缩阈值**：500KB

## 权限和安全

### 访问权限
- 所有登录用户都可以查看Logo
- 只有管理员可以上传和删除Logo
- 未来版本将添加更细粒度的权限控制

### 安全措施
- **文件类型验证**：只允许图片文件
- **大小限制**：防止过大文件上传
- **云端存储**：使用Firebase的安全规则
- **URL验证**：确保只处理有效的图片URL

## 故障排除

### 常见问题

1. **上传失败**
   - 检查网络连接
   - 确认文件格式和大小
   - 查看浏览器控制台错误信息

2. **图片不显示**
   - 检查图片URL是否有效
   - 确认Firebase Storage配置
   - 刷新页面重新加载

3. **删除失败**
   - 检查网络连接
   - 确认用户权限
   - 查看控制台错误信息

4. **压缩问题**
   - 检查图片格式是否支持
   - 确认浏览器Canvas支持
   - 尝试使用不同格式的图片

### 调试信息
- 打开浏览器开发者工具
- 查看Console标签页的错误信息
- 检查Network标签页的请求状态

## 更新日志

- **v1.0.0** (2024-01-10)
  - 初始版本发布
  - 支持基本的图片上传和预览
  - 集成Firebase Storage
  - 添加图片压缩功能
  - 支持CRUD操作

## 未来计划

- **批量上传**：支持一次上传多张图片
- **图片编辑**：内置图片裁剪和调整功能
- **格式转换**：自动转换图片格式
- **CDN加速**：使用CDN提高图片加载速度
- **权限细化**：更精细的权限控制
