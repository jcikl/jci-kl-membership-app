# 项目户口绑定功能使用指南

## 📋 功能概述

项目户口绑定功能允许将活动与特定的项目户口关联，实现更精细的数据追踪和财务管理。通过项目户口，可以统一管理特定项目的所有活动数据，包括财务收支、注册统计、预算控制等。

## 🎯 主要功能

### 1. 项目户口管理
- **创建项目户口**: 为特定项目创建专门的户口
- **预算管理**: 设置项目预算和货币类型
- **负责人管理**: 指定项目负责人和联系方式
- **状态管理**: 支持活跃、停用、已完成等状态

### 2. 活动绑定
- **活动创建时绑定**: 在创建活动时选择关联的项目户口
- **活动编辑时绑定**: 修改现有活动的项目户口关联
- **批量管理**: 支持批量查看和管理同一项目的所有活动

### 3. 数据追踪
- **财务追踪**: 实时监控项目收支情况
- **注册统计**: 追踪项目活动的注册人数和参与情况
- **预算使用率**: 显示预算使用情况和剩余额度
- **活动统计**: 统计项目的所有活动数量和状态

## 🏗️ 技术架构

### 数据模型

#### ProjectAccount（项目户口）
```typescript
interface ProjectAccount {
  id: string;
  name: string;                    // 项目户口名称
  description: string;             // 项目描述
  fiscalYear: string;             // 财政年度
  budget: number;                 // 预算金额
  currency: string;               // 货币类型
  responsiblePerson: string;      // 负责人姓名
  responsiblePersonEmail: string; // 负责人邮箱
  status: 'active' | 'inactive' | 'completed'; // 状态
  createdAt: Timestamp;           // 创建时间
  updatedAt: Timestamp;           // 更新时间
}
```

#### Event（活动）- 新增字段
```typescript
interface Event {
  // ... 原有字段
  projectAccountId?: string;      // 关联的项目户口ID
  projectAccount?: ProjectAccount; // 项目户口详情（关联查询）
}
```

### 服务层

#### ProjectAccountService
- `createProjectAccount()` - 创建项目户口
- `updateProjectAccount()` - 更新项目户口
- `deleteProjectAccount()` - 删除项目户口
- `getProjectAccount()` - 获取项目户口详情
- `getProjectAccounts()` - 获取项目户口列表
- `getActiveProjectAccounts()` - 获取活跃的项目户口
- `getProjectAccountEventStatistics()` - 获取项目活动统计

#### EventService - 新增方法
- `getEventsByProjectAccount()` - 根据项目户口获取活动列表
- `getProjectAccountEventSummary()` - 获取项目活动汇总统计

## 📁 文件结构

```
src/
├── types/
│   └── event.ts                    # 更新：添加项目户口相关类型
├── services/
│   ├── eventService.ts             # 更新：添加项目户口相关方法
│   └── projectAccountService.ts    # 新增：项目户口服务
├── components/
│   ├── EventForm.tsx               # 更新：添加项目户口选择
│   ├── EventDetail.tsx             # 更新：显示项目户口信息
│   ├── EventList.tsx               # 更新：显示项目户口关联
│   ├── ProjectAccountManagement.tsx # 新增：项目户口管理组件
│   └── ProjectAccountTracker.tsx   # 新增：项目户口数据追踪组件
└── pages/
    └── EventManagementPage.tsx     # 更新：集成项目户口管理
```

## 🚀 使用指南

### 1. 创建项目户口

1. **访问项目户口管理**:
   - 登录系统后，点击"活动管理"
   - 切换到"项目户口"标签
   - 点击"户口管理"子标签

2. **创建新户口**:
   - 点击"创建项目户口"按钮
   - 填写项目户口信息：
     - 项目户口名称
     - 描述
     - 财政年度
     - 预算金额
     - 货币类型
     - 负责人信息
   - 点击"创建"保存

### 2. 绑定活动到项目户口

1. **创建活动时绑定**:
   - 在创建活动时，在"基本信息"步骤中
   - 选择"项目户口"字段
   - 从下拉列表中选择对应的项目户口
   - 继续完成活动创建流程

2. **编辑现有活动**:
   - 进入活动详情页面
   - 点击"编辑活动"
   - 在基本信息中修改项目户口选择
   - 保存更改

### 3. 追踪项目数据

1. **查看项目户口详情**:
   - 在项目户口列表中点击"查看详情"
   - 查看项目基本信息、统计数据和相关活动

2. **使用数据追踪功能**:
   - 切换到"数据追踪"子标签
   - 选择要追踪的项目户口
   - 可选设置日期范围筛选
   - 查看详细的统计数据和活动列表

### 4. 财务监控

1. **预算使用率**:
   - 实时显示预算使用百分比
   - 当使用率超过100%时显示警告
   - 显示已使用金额和剩余预算

2. **收入统计**:
   - 显示项目所有活动的总收入
   - 按活动类型和状态分类统计
   - 支持导出财务报表

## 🔧 配置说明

### 财政年度设置
系统支持多个财政年度的项目户口管理：
- 2024年
- 2025年
- 2026年

### 货币类型支持
- MYR (马来西亚林吉特)
- USD (美元)
- SGD (新加坡元)

### 项目状态管理
- **active**: 活跃项目，可以创建新活动
- **inactive**: 停用项目，暂停新活动创建
- **completed**: 已完成项目，归档状态

## 📊 数据统计功能

### 项目户口统计
- 总活动数
- 已发布活动数
- 总注册人数
- 总收入
- 预算使用率

### 活动分类统计
- 按活动类型统计
- 按活动状态统计
- 按时间范围统计
- 按收入类型统计

### 导出功能
- 项目户口数据导出
- 活动列表导出
- 财务报表导出
- 统计数据导出

## 🔐 权限控制

### 项目户口管理权限
- **管理员**: 完整的项目户口管理权限
- **项目负责人**: 管理自己负责的项目户口
- **财务人员**: 查看财务相关数据
- **普通用户**: 查看公开的项目信息

### 数据访问控制
- 项目户口数据按权限分级访问
- 敏感财务信息仅限授权人员查看
- 支持审计日志记录

## 🚀 部署说明

### 初始化演示数据
```bash
# 初始化项目户口和活动数据
npm run init:events
```

### Firestore 集合结构
```
projectAccounts/          # 项目户口集合
├── {accountId}/
│   ├── name: string
│   ├── description: string
│   ├── fiscalYear: string
│   ├── budget: number
│   ├── currency: string
│   ├── responsiblePerson: string
│   ├── responsiblePersonEmail: string
│   ├── status: string
│   └── timestamps

events/                   # 活动集合（更新）
├── {eventId}/
│   ├── ... (原有字段)
│   └── projectAccountId: string  # 新增：项目户口关联
```

## 🐛 故障排除

### 常见问题

1. **项目户口选择为空**
   - 检查是否有创建活跃状态的项目户口
   - 确认财政年度设置正确
   - 检查用户权限

2. **统计数据不准确**
   - 确认活动已正确绑定项目户口
   - 检查活动状态和注册数据
   - 验证财务数据完整性

3. **预算使用率计算错误**
   - 检查货币类型一致性
   - 确认收入数据正确性
   - 验证预算金额设置

## 📈 未来规划

### 计划功能
- [ ] 项目户口预算预警系统
- [ ] 自动财务报表生成
- [ ] 项目进度跟踪
- [ ] 多项目对比分析
- [ ] 项目绩效评估
- [ ] 预算分配优化建议

### 集成计划
- [ ] 与财务系统深度集成
- [ ] 与会员管理系统联动
- [ ] 与报告系统集成
- [ ] 移动端支持

## 🤝 最佳实践

### 项目户口命名
- 使用清晰的命名规则
- 包含财政年度信息
- 体现项目性质

### 预算管理
- 合理设置预算金额
- 定期监控使用情况
- 及时调整预算分配

### 数据维护
- 定期清理过期数据
- 保持数据一致性
- 及时更新项目状态

---

**项目户口绑定功能** - 让项目管理更精细、更高效！

通过项目户口绑定，JCI Kuala Lumpur 可以更好地追踪和管理各类项目活动，实现数据的统一管理和财务的精确控制。
