# äº¤æ˜“æ‹†åˆ†è®°å½•æ˜¾ç¤ºä¿®å¤

## ğŸ¯ é—®é¢˜æè¿°

åœ¨äº¤æ˜“ç®¡ç†ç•Œé¢ä¸­ï¼Œä¸»äº¤æ˜“è®°å½•ä¸ºæ”¶å…¥ç±»å‹ï¼ˆå¦‚RM 128.00æ”¶å…¥ï¼‰ï¼Œä½†æ‹†åˆ†åçš„è®°å½•å´é”™è¯¯åœ°æ˜¾ç¤ºåœ¨æ”¯å‡ºåˆ—ä¸­ï¼Œè¿™è¿åäº†è´¢åŠ¡é€»è¾‘ã€‚

### é—®é¢˜ç°è±¡
- **ä¸»äº¤æ˜“è®°å½•**ï¼šæ˜¾ç¤ºä¸ºæ”¶å…¥ RM 128.00ï¼ˆç»¿è‰²ï¼‰
- **æ‹†åˆ†è®°å½•**ï¼šé”™è¯¯åœ°æ˜¾ç¤ºä¸ºæ”¯å‡º RM 100.00, RM 28.00ï¼ˆçº¢è‰²ï¼‰

### é—®é¢˜åŸå› 
åœ¨`TransactionManagement.tsx`ç»„ä»¶çš„è¡¨æ ¼åˆ—æ¸²æŸ“é€»è¾‘ä¸­ï¼š
1. æ‹†åˆ†è®°å½•æ€»æ˜¯æ˜¾ç¤ºåœ¨æ”¯å‡ºåˆ—ï¼Œä½¿ç”¨çº¢è‰²å­—ä½“
2. æ‹†åˆ†è®°å½•åœ¨æ”¶å…¥åˆ—æ€»æ˜¯æ˜¾ç¤º"-"
3. æ²¡æœ‰æ ¹æ®ä¸»äº¤æ˜“è®°å½•çš„ç±»å‹æ¥åˆ¤æ–­æ‹†åˆ†è®°å½•çš„æ˜¾ç¤ºä½ç½®

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. æ”¯å‡ºåˆ—æ˜¾ç¤ºé€»è¾‘ä¿®å¤

**ä¿®å¤å‰ï¼š**
```typescript
render: (amount: number, record: any) => {
  if (record.isSplitRecord) {
    // æ‰€æœ‰æ‹†åˆ†è®°å½•éƒ½æ˜¾ç¤ºåœ¨æ”¯å‡ºåˆ—
    return (
      <Text style={{ color: '#ff4d4f', fontWeight: 'bold' }}>
        RM {record.amount.toLocaleString('en-MY', { minimumFractionDigits: 2 })}
      </Text>
    );
  }
  // ...
}
```

**ä¿®å¤åï¼š**
```typescript
render: (amount: number, record: any) => {
  if (record.isSplitRecord) {
    // æ‹†åˆ†è®°å½•ï¼šå¦‚æœæ˜¯æ”¶å…¥ç±»å‹çš„æ‹†åˆ†ï¼Œä¸æ˜¾ç¤ºåœ¨æ”¯å‡ºåˆ—
    const parentTransaction = transactions.find(t => t.id === record.transactionId);
    if (parentTransaction && parentTransaction.income > 0) {
      return '-'; // æ”¶å…¥ç±»å‹çš„æ‹†åˆ†ä¸æ˜¾ç¤ºåœ¨æ”¯å‡ºåˆ—
    }
    // æ”¯å‡ºç±»å‹çš„æ‹†åˆ†æ˜¾ç¤ºåœ¨æ”¯å‡ºåˆ—
    return (
      <Text style={{ color: '#ff4d4f', fontWeight: 'bold' }}>
        RM {record.amount.toLocaleString('en-MY', { minimumFractionDigits: 2 })}
      </Text>
    );
  }
  // ...
}
```

### 2. æ”¶å…¥åˆ—æ˜¾ç¤ºé€»è¾‘ä¿®å¤

**ä¿®å¤å‰ï¼š**
```typescript
render: (amount: number, record: any) => {
  if (record.isSplitRecord) {
    return '-'; // æ‰€æœ‰æ‹†åˆ†è®°å½•åœ¨æ”¶å…¥åˆ—éƒ½æ˜¾ç¤º"-"
  }
  // ...
}
```

**ä¿®å¤åï¼š**
```typescript
render: (amount: number, record: any) => {
  if (record.isSplitRecord) {
    // æ‹†åˆ†è®°å½•ï¼šå¦‚æœæ˜¯æ”¶å…¥ç±»å‹çš„æ‹†åˆ†ï¼Œæ˜¾ç¤ºåœ¨æ”¶å…¥åˆ—
    const parentTransaction = transactions.find(t => t.id === record.transactionId);
    if (parentTransaction && parentTransaction.income > 0) {
      return (
        <Text style={{ color: '#52c41a', fontWeight: 'bold' }}>
          RM {record.amount.toLocaleString('en-MY', { minimumFractionDigits: 2 })}
        </Text>
      );
    }
    // æ”¯å‡ºç±»å‹çš„æ‹†åˆ†ä¸æ˜¾ç¤ºåœ¨æ”¶å…¥åˆ—
    return '-';
  }
  // ...
}
```

## ğŸ“Š ä¿®å¤æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰
| è®°å½•ç±»å‹ | æ”¯å‡ºåˆ— | æ”¶å…¥åˆ— |
|---------|--------|--------|
| ä¸»è®°å½•ï¼ˆæ”¶å…¥ï¼‰ | - | RM 128.00 âœ… |
| æ‹†åˆ†è®°å½•1 | RM 100.00 âŒ | - |
| æ‹†åˆ†è®°å½•2 | RM 28.00 âŒ | - |

### ä¿®å¤å
| è®°å½•ç±»å‹ | æ”¯å‡ºåˆ— | æ”¶å…¥åˆ— |
|---------|--------|--------|
| ä¸»è®°å½•ï¼ˆæ”¶å…¥ï¼‰ | - | RM 128.00 âœ… |
| æ‹†åˆ†è®°å½•1 | - | RM 100.00 âœ… |
| æ‹†åˆ†è®°å½•2 | - | RM 28.00 âœ… |

## ğŸ¯ æ ¸å¿ƒé€»è¾‘

### åˆ¤æ–­è§„åˆ™
1. **è·å–ä¸»äº¤æ˜“è®°å½•**ï¼šé€šè¿‡`record.transactionId`æŸ¥æ‰¾å¯¹åº”çš„ä¸»äº¤æ˜“è®°å½•
2. **æ£€æŸ¥äº¤æ˜“ç±»å‹**ï¼šåˆ¤æ–­`parentTransaction.income > 0`æ¥ç¡®å®šæ˜¯å¦ä¸ºæ”¶å…¥ç±»å‹
3. **å†³å®šæ˜¾ç¤ºä½ç½®**ï¼š
   - æ”¶å…¥ç±»å‹çš„æ‹†åˆ† â†’ æ˜¾ç¤ºåœ¨æ”¶å…¥åˆ—ï¼ˆç»¿è‰²ï¼‰
   - æ”¯å‡ºç±»å‹çš„æ‹†åˆ† â†’ æ˜¾ç¤ºåœ¨æ”¯å‡ºåˆ—ï¼ˆçº¢è‰²ï¼‰

### ä»£ç å®ç°
```typescript
// æŸ¥æ‰¾ä¸»äº¤æ˜“è®°å½•
const parentTransaction = transactions.find(t => t.id === record.transactionId);

// åˆ¤æ–­äº¤æ˜“ç±»å‹
if (parentTransaction && parentTransaction.income > 0) {
  // æ”¶å…¥ç±»å‹çš„æ‹†åˆ†è®°å½•
  // æ”¯å‡ºåˆ—æ˜¾ç¤º"-"ï¼Œæ”¶å…¥åˆ—æ˜¾ç¤ºé‡‘é¢
} else {
  // æ”¯å‡ºç±»å‹çš„æ‹†åˆ†è®°å½•
  // æ”¶å…¥åˆ—æ˜¾ç¤º"-"ï¼Œæ”¯å‡ºåˆ—æ˜¾ç¤ºé‡‘é¢
}
```

## âœ… æµ‹è¯•éªŒè¯

### 1. æ”¶å…¥ç±»å‹æ‹†åˆ†æµ‹è¯•
- **æµ‹è¯•åœºæ™¯**ï¼šä¸»äº¤æ˜“è®°å½•ä¸ºæ”¶å…¥ RM 128.00
- **é¢„æœŸç»“æœ**ï¼š
  - æ‹†åˆ†è®°å½•1ï¼šæ”¶å…¥åˆ—æ˜¾ç¤º RM 100.00ï¼ˆç»¿è‰²ï¼‰
  - æ‹†åˆ†è®°å½•2ï¼šæ”¶å…¥åˆ—æ˜¾ç¤º RM 28.00ï¼ˆç»¿è‰²ï¼‰
  - æ”¯å‡ºåˆ—éƒ½æ˜¾ç¤º"-"

### 2. æ”¯å‡ºç±»å‹æ‹†åˆ†æµ‹è¯•
- **æµ‹è¯•åœºæ™¯**ï¼šä¸»äº¤æ˜“è®°å½•ä¸ºæ”¯å‡º RM 500.00
- **é¢„æœŸç»“æœ**ï¼š
  - æ‹†åˆ†è®°å½•1ï¼šæ”¯å‡ºåˆ—æ˜¾ç¤º RM 300.00ï¼ˆçº¢è‰²ï¼‰
  - æ‹†åˆ†è®°å½•2ï¼šæ”¯å‡ºåˆ—æ˜¾ç¤º RM 200.00ï¼ˆçº¢è‰²ï¼‰
  - æ”¶å…¥åˆ—éƒ½æ˜¾ç¤º"-"

### 3. æ··åˆç±»å‹æµ‹è¯•
- **æµ‹è¯•åœºæ™¯**ï¼šä¸åŒé“¶è¡Œæˆ·å£çš„äº¤æ˜“è®°å½•
- **é¢„æœŸç»“æœ**ï¼šæ¯ä¸ªæ‹†åˆ†è®°å½•éƒ½æ ¹æ®å…¶ä¸»äº¤æ˜“è®°å½•ç±»å‹æ­£ç¡®æ˜¾ç¤º

## ğŸ”„ æ•°æ®æµç¨‹

### 1. æ•°æ®åŠ è½½æµç¨‹
```
TransactionManagement ç»„ä»¶åŠ è½½
    â†“
åŠ è½½äº¤æ˜“è®°å½•åˆ—è¡¨
    â†“
åŠ è½½æ‹†åˆ†è®°å½•åˆ—è¡¨
    â†“
æ„å»ºè¡¨æ ¼æ•°æ®ï¼ˆåŒ…å«æ‹†åˆ†è®°å½•ï¼‰
    â†“
æ¸²æŸ“è¡¨æ ¼åˆ—
```

### 2. æ˜¾ç¤ºåˆ¤æ–­æµç¨‹
```
æ¸²æŸ“æ‹†åˆ†è®°å½•
    â†“
è·å– record.transactionId
    â†“
æŸ¥æ‰¾å¯¹åº”çš„ä¸»äº¤æ˜“è®°å½•
    â†“
åˆ¤æ–­ parentTransaction.income > 0
    â†“
å†³å®šæ˜¾ç¤ºåœ¨æ”¶å…¥åˆ—æˆ–æ”¯å‡ºåˆ—
```

## ğŸ› ï¸ æŠ€æœ¯ç»†èŠ‚

### 1. æ€§èƒ½è€ƒè™‘
- ä½¿ç”¨`transactions.find()`æŸ¥æ‰¾ä¸»äº¤æ˜“è®°å½•
- åœ¨æ¸²æŸ“æ—¶è¿›è¡Œåˆ¤æ–­ï¼Œé¿å…é¢„å¤„ç†å¼€é”€
- è€ƒè™‘ä½¿ç”¨Mapä¼˜åŒ–æŸ¥æ‰¾æ€§èƒ½ï¼ˆå¦‚æœäº¤æ˜“è®°å½•å¾ˆå¤šï¼‰

### 2. æ•°æ®ä¸€è‡´æ€§
- ç¡®ä¿`transactionId`çš„æ­£ç¡®å…³è”
- å¤„ç†ä¸»äº¤æ˜“è®°å½•ä¸å­˜åœ¨çš„æƒ…å†µ
- ä¿æŒæ‹†åˆ†è®°å½•ä¸ä¸»äº¤æ˜“è®°å½•çš„æ•°æ®åŒæ­¥

### 3. é”™è¯¯å¤„ç†
- å¤„ç†`parentTransaction`ä¸ºundefinedçš„æƒ…å†µ
- ç¡®ä¿é‡‘é¢æ ¼å¼çš„æ­£ç¡®æ˜¾ç¤º
- ä¿æŒUIçš„ä¸€è‡´æ€§å’Œç¾è§‚æ€§

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### 1. æ€§èƒ½ä¼˜åŒ–
```typescript
// ä½¿ç”¨Mapä¼˜åŒ–æŸ¥æ‰¾æ€§èƒ½
const transactionMap = useMemo(() => {
  return new Map(transactions.map(t => [t.id, t]));
}, [transactions]);

// åœ¨æ¸²æŸ“æ—¶ä½¿ç”¨MapæŸ¥æ‰¾
const parentTransaction = transactionMap.get(record.transactionId);
```

### 2. ç±»å‹å®‰å…¨
```typescript
// æ·»åŠ æ›´ä¸¥æ ¼çš„ç±»å‹å®šä¹‰
interface SplitRecordWithParent extends TransactionSplit {
  parentTransaction?: Transaction;
  isIncomeSplit?: boolean;
}
```

### 3. ç”¨æˆ·ä½“éªŒ
- æ·»åŠ æ‹†åˆ†è®°å½•çš„è§†è§‰å±‚çº§æ ‡è¯†
- ä¼˜åŒ–æ‹†åˆ†è®°å½•çš„ç¼©è¿›æ˜¾ç¤º
- æ·»åŠ æ‹†åˆ†è®°å½•çš„æ“ä½œæŒ‰é’®

---

**ä¿®å¤æ—¥æœŸ**: 2025å¹´1æœˆ
**ç‰ˆæœ¬**: 1.1.1
**ç»´æŠ¤è€…**: JCI KL è´¢åŠ¡ç®¡ç†ç³»ç»Ÿå›¢é˜Ÿ
